<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Danh s√°ch h·ªì s∆° | Admission Check</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="hutech.png" sizes="32x32">
  <link rel="apple-touch-icon" href="hutech.png">
  <meta name="theme-color" content="#2563eb">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-6 space-y-6">
    <!-- Header -->
    <header class="flex flex-wrap gap-3 items-center justify-between">
      <div class="flex items-center gap-3 min-w-0">
        <a href="/index_home.html" title="V·ªÅ trang ch·ªß" class="flex items-center gap-3 hover:opacity-80 transition">
          <img src="hutech.png" alt="HUTECH" class="h-8 w-8 object-contain select-none" />
        </a>
        <div>
          <h1 class="text-2xl font-bold leading-none truncate">Danh s√°ch h·ªì s∆°</h1>
          <p class="text-sm text-gray-500">Tra c·ª©u nhanh & thao t√°c in/xu·∫•t.</p>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <label for="apiBase" class="text-sm text-gray-500">API Base</label>
        <input id="apiBase" class="input w-52 md:w-72" placeholder="" />
        <span class="hidden md:inline-block w-px h-6 bg-gray-200"></span>

        <!-- User status -->
        <div id="userBox" class="text-sm text-gray-600 flex items-center gap-2">
          <span id="meText" class="hidden">
            ‚úåÔ∏è Xin ch√†o: <b id="meName"></b> (<span id="meRole"></span>)
          </span>
          <a id="loginLink" href="/login" class="btn btn-outline">ƒêƒÉng nh·∫≠p</a>
          <button id="btnLogout" class="btn btn-outline hidden">LogOut</button>
        </div>

        <a class="btn btn-outline" href="/" title="Bi√™n so·∫°n H·ªì S∆°">Bi√™n so·∫°n H·ªì S∆°</a>
        <a id="journalLink" class="btn btn-outline" href="/journal.html" title="Nh·∫≠t k√Ω" hidden>üßæ Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</a>
        <a class="btn btn-outline" href="/index_home.html" title="Trang ch·ªß">‚Üê Trang ch·ªß</a>
      </div>
    </header>

    <!-- Toolbar -->
    <section class="card space-y-4">
      <!-- H√†ng 1: T√¨m ki·∫øm + L·ªçc ƒë·ª£t/kh√≥a -->
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-3 items-end">
        <!-- √î t√¨m chung -->
        <div class="xl:col-span-2">
          <div class="flex items-center gap-2">
            <div class="relative flex-1 min-w-[240px]">
              <input id="q" class="input w-full pl-10" placeholder="Nh·∫≠p h·ªç t√™n ho·∫∑c MSHV..." aria-label="T·ª´ kh√≥a" />
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" aria-hidden="true">üîé</span>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <input id="filterDot"  class="input" placeholder="L·ªçc theo ƒê·ª£t"  title="VD: 1 ho·∫∑c 1/2025" />
              <input id="filterKhoa" class="input" placeholder="L·ªçc theo Kh√≥a" title="VD: 27" />
            </div>
            <button id="btnSearch" class="btn btn-outline shrink-0" aria-label="T√¨m">üîé T√¨m</button>
          </div>
        </div>
      </div>
      <h2 class="font-bold">IN / XU·∫§T D·ªÆ LI·ªÜU</h2>
      <!-- H√†ng 2: Theo ng√†y + Theo ƒë·ª£t -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <!-- Theo ng√†y -->
        <div class="flex flex-wrap items-center gap-2 min-w-0">
          <input id="day" type="date" class="input w-36 sm:w-40 md:w-44 lg:w-48 flex-none" />
          <button id="btnExportDay" class="btn btn-outline shrink-0" title="Xu·∫•t Excel theo ng√†y">‚¨áÔ∏è Excel</button>
          <button id="btnPrintDay"  class="btn btn-primary shrink-0" title="In PDF g·ªôp theo ng√†y">üñ®Ô∏è PDF</button>
          <p class="w-full text-xs text-gray-500">G·ª≠i in theo ng√†y nh·∫≠n h·ªì s∆°.</p>
        </div>

        <!-- Theo ƒë·ª£t (+Kh√≥a) server-side -->
        <div class="flex flex-wrap items-center gap-2 min-w-0">
          <input id="dot" class="input w-24 sm:w-28 md:w-32 flex-none" placeholder="Nh·∫≠p t√™n ƒë·ª£t" title="VD: 1" />
          <input id="dotKhoa" class="input w-24 sm:w-28 md:w-32 flex-none" placeholder="Nh·∫≠p Kh√≥a" title="VD: 25" />
          <button id="btnExportDot" class="btn btn-outline shrink-0" title="Xu·∫•t Excel theo ƒë·ª£t + kh√≥a">‚¨áÔ∏è Excel</button>
          <button id="btnPrintDot"  class="btn btn-primary shrink-0" title="In PDF g·ªôp theo ƒë·ª£t + kh√≥a">üñ®Ô∏è PDF</button>
          <p class="w-full text-xs text-gray-500">G·ª≠i in/xu·∫•t theo <b>ƒë·ª£t</b>; ho·∫∑c nh·∫≠p th√™m <b>Kh√≥a</b> n·∫øu c·∫ßn.</p>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section class="card space-y-3">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <div class="text-sm text-gray-600">K·∫øt qu·∫£: <span id="count" class="badge">0</span></div>
        <div id="msg" class="text-sm text-gray-600" role="status" aria-live="polite"></div>
      </div>

      <!-- Pagination toolbar (top) -->
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-2 text-sm">
          <span>Hi·ªÉn th·ªã</span>
          <select id="pageSize" class="input w-24">
            <option selected>10</option><option>20</option><option>50</option><option>100</option>
          </select>
          <span>d√≤ng/trang</span>
        </div>
        <div class="flex items-center gap-1 text-sm pager" data-position="top">
          <button class="btn btn-outline btn-xs pager-first"  title="Trang ƒë·∫ßu">‚èÆÔ∏è</button>
          <button class="btn btn-outline btn-xs pager-prev"   title="Trang tr∆∞·ªõc">‚è™</button>
          <span class="mx-2 min-w-[160px] text-center pager-info">Trang 1/1 ‚Ä¢ 0 m·ª•c</span>
          <button class="btn btn-outline btn-xs pager-next"   title="Trang sau">‚è©</button>
          <button class="btn btn-outline btn-xs pager-last"   title="Trang cu·ªëi">‚è≠Ô∏è</button>
        </div>
      </div>

      <div class="overflow-hidden border rounded-xl">
        <div id="emptyState" class="p-10 text-center text-gray-500 hidden">
          <div class="text-4xl mb-2">üìÑ</div>
          <div class="font-semibold">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
          <div class="text-sm">Nh·∫≠p ƒëi·ªÅu ki·ªán v√† b·∫•m <b>T√¨m</b>.</div>
        </div>

        <div id="tableWrap" class="overflow-auto hidden">
          <table class="table min-w-full">
            <thead>
              <tr>
                <th class="text-left">M√£ HS</th>
                <th class="text-left">H·ªç t√™n</th>
                <th class="text-left th-sortable" data-sort="ma_so_hv" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo MSHV">MSHV <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="th-sortable" data-sort="ngay_nhan_hs" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo Ng√†y nh·∫≠n">Ng√†y nh·∫≠n <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="th-sortable" data-sort="nganh" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo Ng√†nh">Ng√†nh <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="th-sortable" data-sort="dot" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo ƒê·ª£t">ƒê·ª£t <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="th-sortable" data-sort="khoa" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo Kh√≥a">Kh√≥a <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="th-sortable" data-sort="nguoi_nhan" role="button" tabindex="0" aria-label="S·∫Øp x·∫øp theo Ng∆∞·ªùi nh·∫≠n">Ng∆∞·ªùi nh·∫≠n <span class="arrow">‚ñ≤‚ñº</span></th>
                <th class="text-center">In</th>
                <th class="text-center">S·ª≠a/X√≥a</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div id="loading" class="p-8 text-center text-gray-500 hidden">
          <span class="inline-block w-5 h-5 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin align-[-2px]" aria-hidden="true"></span>
          <span class="ml-2">ƒêang t·∫£i‚Ä¶</span>
        </div>
      </div>

      <!-- Pagination toolbar (bottom) -->
      <div class="flex items-center gap-1 text-sm pager" data-position="bottom">
        <button class="btn btn-outline btn-xs pager-first" title="Trang ƒë·∫ßu">‚èÆÔ∏è</button>
        <button class="btn btn-outline btn-xs pager-prev"  title="Trang tr∆∞·ªõc">‚è™</button>
        <span class="mx-2 min-w-[160px] text-center pager-info">Trang 1/1 ‚Ä¢ 0 m·ª•c</span>
        <button class="btn btn-outline btn-xs pager-next"  title="Trang sau">‚è©</button>
        <button class="btn btn-outline btn-xs pager-last"  title="Trang cu·ªëi">‚è≠Ô∏è</button>
      </div>
    </section>
  </div>

  <!-- Modal Edit -->
  <div id="editModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal p-6" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="flex items-center justify-between mb-4">
        <h3 id="editTitle" class="text-lg font-semibold">Ch·ªânh s·ª≠a h·ªì s∆°</h3>
        <button id="btnCloseModal" class="btn btn-outline btn-xs" aria-label="ƒê√≥ng">‚úï</button>
      </div>
      <form id="editForm" class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div><label class="text-sm text-gray-600">MSHV (kh√≥a)</label><input id="e_mshv" class="input bg-gray-100" readonly></div>
        <div><label class="text-sm text-gray-600">M√£ h·ªì s∆°</label><input id="e_ma_ho_so" class="input"></div>
        <div><label class="text-sm text-gray-600">H·ªç t√™n</label><input id="e_ho_ten" class="input"></div>
        <div><label class="text-sm text-gray-600">Email h·ªçc vi√™n</label><input id="e_email" class="input" type="email"></div>
        <div><label class="text-sm text-gray-600">S·ªë ƒêT</label><input id="e_so_dt" class="input"></div>
        <div><label class="text-sm text-gray-600">Ng√†nh nh·∫≠p h·ªçc</label><input id="e_nganh" class="input"></div>
        <div><label class="text-sm text-gray-600">ƒê·ª£t</label><input id="e_dot" class="input"></div>
        <div><label class="text-sm text-gray-600">Kh√≥a</label><input id="e_khoa" class="input"></div>
        <div><label class="text-sm text-gray-600">Ng√†y nh·∫≠n HS</label><input id="e_ngay_nhan" class="input" type="date"></div>
        <div><label class="text-sm text-gray-600">Ng√†y sinh</label><input id="e_ngay_sinh" class="input" type="date"></div>
        <div class="md:col-span-2"><label class="text-sm text-gray-600">Ghi ch√∫</label><input id="e_ghi_chu" class="input"></div>
        <div class="md:col-span-2 flex items-center justify-end gap-2 pt-2">
          <button type="button" id="btnCancelEdit" class="btn btn-outline">H·ªßy</button>
          <button type="submit" id="btnSaveEdit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal nh·∫≠p l√Ω do xo√° -->
  <div id="delModal" class="overlay" aria-modal="true" role="dialog">
    <div class="modal">
      <div class="hd">X√≥a h·ªì s∆°</div>
      <div class="bd">
        <p id="delMsg" class="mb-2 text-sm text-gray-700"></p>
        <label class="text-sm text-gray-800 font-semibold block mb-1">L√Ω do xo√° (b·∫Øt bu·ªôc)</label>
        <textarea id="delReason" placeholder="Nh·∫≠p l√Ω do‚Ä¶"></textarea>
        <p id="delErr" class="mt-1 text-xs text-rose-600 hidden">Vui l√≤ng nh·∫≠p l√Ω do!</p>
      </div>
      <div class="ft">
        <button id="delCancel" class="btn btn-outline">H·ªßy</button>
        <button id="delOk" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>

  <footer class="max-w-6xl mx-auto px-6 pb-4 text-right text-xs text-gray-500">
    ¬© <span class="font-semibold">
      <a href="https://hutech.edu.vn/e-hutech" target="_blank" rel="noopener noreferrer">V-HT.PTƒêT HUTECH</a>
    </span>
    ‚ûñ Code by:
    <span class="font-semibold">
      <a href="http://zalo.me/tuanconghuynh" target="_blank" rel="noopener noreferrer">HC- Tuan</a>
    </span>
  </footer>

  <script>
    // ·∫®n l√∫c ki·ªÉm tra login
    document.documentElement.style.visibility = 'hidden';

    // ===== helpers =====
    const $ = id => document.getElementById(id);
    const STORAGE_KEY = "apiBase";
    const PREFIX_CANDIDATES = ["", "/api"];
    let API_PREFIX = "";

    const debounce = (fn, ms=300) => { let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); }; };

    (function initApiBase(){
      const saved = localStorage.getItem(STORAGE_KEY) || window.location.origin;
      $("apiBase").value = saved;
    })();

    const apiBase = () => $("apiBase").value.trim().replace(/\/+$/,'');
    const makeUrl = (path) => apiBase() + API_PREFIX + path;

    async function detectPrefix() {
      for (const p of PREFIX_CANDIDATES) {
        try { const r = await fetch(apiBase() + p + "/health", {credentials:"include"}); if (r.ok) { API_PREFIX = p; return; } } catch(_){}
      }
      API_PREFIX = ""; // fallback
    }

    async function apiFetch(path, init={}){
      const opts = {credentials:"include", ...init};
      let r = await fetch(makeUrl(path), opts).catch(()=>null);
      if (r && r.status !== 404) return r;
      // th·ª≠ prefix c√≤n l·∫°i n·∫øu 404
      const alt = (API_PREFIX === "" ? "/api" : "");
      if (alt !== API_PREFIX) {
        try { const r2 = await fetch(apiBase() + alt + path, opts); if (r2.ok) { API_PREFIX = alt; return r2; } return r2; } catch(e){ return null; }
      }
      return r;
    }

    function fmtDMY(s) {
      if (!s) return "";
      const t = String(s).trim();
      if (/^\d{2}\/\d{2}\/\d{4}$/.test(t)) return t;
      const m = t.match(/^(\d{4})-(\d{2})-(\d{2})/);
      if (m) return `${m[3]}/${m[2]}/${m[1]}`;
      const d = new Date(t);
      if (!isNaN(d)) {
        const dd = String(d.getDate()).padStart(2, "0");
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const yy = d.getFullYear();
        return `${dd}/${mm}/${yy}`;
      }
      return t;
    }

    const dash = (x)=> (x && String(x).trim()!=="") ? x : '<span class="text-muted">‚Äî</span>';

    function setState({loading=false, empty=false}){
      $("loading").classList.toggle("hidden", !loading);
      $("emptyState").classList.toggle("hidden", !empty);
      $("tableWrap").classList.toggle("hidden", loading || empty);
    }

    // ===== Auth check (/me) =====
    async function ensureLoggedIn(){
      await detectPrefix();
      try{
        const r = await apiFetch("/me");
        if (!r || !r.ok) throw new Error();
        const me = await r.json();
        $("meName").textContent = me.full_name || me.username || "";
        $("meRole").textContent = me.role || "";
        $("meText").classList.remove("hidden");
        $("loginLink").classList.add("hidden");
        $("btnLogout").classList.remove("hidden");
        document.documentElement.style.visibility = '';
      }catch{
        const next = encodeURIComponent(location.pathname + location.search);
        location.replace(`/login?next=${next}`);
      }
    }
    $("btnLogout")?.addEventListener("click", async ()=>{
      try{ await apiFetch("/logout", {method:"POST"}); }catch(_) {}
      location.href = "/login";
    });

    // ===== Data/paging/sort state =====
    const state = {
      q: "",
      page: 1,
      size: 10,
      total: 0,
      cachedAllForFilter: [],
      sort: { key: null, dir: 'asc' }, // 'ma_so_hv' | 'dot' | 'khoa' | 'nganh' | 'ngay_nhan_hs' | 'nguoi_nhan'
      cacheAll: [] // cache to√†n b·ªô dataset cho truy v·∫•n hi·ªán t·∫°i (ƒë·ªÉ sort tr√™n to√†n t·∫≠p)
    };
    function pagesTotal(){ return Math.max(1, Math.ceil(state.total / state.size)); }

    // ===== Xo√° m·ªÅm (client blacklist theo session) =====
    function isDeletedFlag(it){
      // Server c√≥ c·ªù n√†o th√¨ li·ªát k√™ ·ªü ƒë√¢y
      return !!(it?.deleted || it?.is_deleted || it?.deleted_at || it?.status === 'deleted');
    }
    const deletedMshv = new Set(JSON.parse(sessionStorage.getItem('deletedMshv') || '[]'));
    function persistDeletedMshv(){
      try { sessionStorage.setItem('deletedMshv', JSON.stringify([...deletedMshv])); } catch(_){}
    }

    function notDeleted(it){
      const id = String(it?.ma_so_hv || '');
      // ·∫©n n·∫øu: (1) b·ªã ch·∫∑n b·ªüi blacklist client trong phi√™n, ho·∫∑c (2) server b√°o ƒë√£ xo√°
      return id && !deletedMshv.has(id) && !isDeletedFlag(it);
    }

    function renderRows(items){
      const tbody = $("tbody"); tbody.innerHTML = "";
      (items||[]).forEach((it) => {
        const nganh = it.nganh_nhap_hoc ?? it.nganh ?? "";
        const khoa  = it.khoa ?? it.khoa_hoc ?? it.khoahoc ?? "";
        const dot   = it.dot ?? it.dot_tuyen ?? "";
        const nguoi = it.nguoi_nhan_ky_ten ?? it.nguoi_nhan ?? it.nguoi_ky ?? "";
        const mshv = it.ma_so_hv;
        const tr = document.createElement("tr");
        tr.className = "row-alt";
        tr.innerHTML = `
          <td class="border-b whitespace-nowrap font-medium">${dash(it.ma_ho_so)}</td>
          <td class="border-b">${dash(it.ho_ten)}</td>
          <td class="border-b">${dash(mshv)}</td>
          <td class="border-b text-center whitespace-nowrap">${dash(fmtDMY(it.ngay_nhan_hs))}</td>
          <td class="border-b">${dash(nganh)}</td>
          <td class="border-b text-center">${dash(dot)}</td>
          <td class="border-b text-center">${dash(khoa)}</td>
          <td class="border-b">${dash(nguoi)}</td>
          <td class="border-b text-center whitespace-nowrap">
            <div class="inline-flex gap-2">
              <a class="btn btn-soft btn-xs btn-pill" href="${makeUrl(`/print/a5/${encodeURIComponent(mshv)}`)}" target="_blank" rel="noopener">A5</a>
              <a class="btn btn-primary btn-xs btn-pill" href="${makeUrl(`/print/a4/${encodeURIComponent(mshv)}`)}" target="_blank" rel="noopener">A4</a>
            </div>
          </td>
          <td class="border-b text-center whitespace-nowrap">
            <div class="inline-flex gap-2">
              <a class="btn btn-outline btn-xs btn-pill" href="/?mshv=${encodeURIComponent(mshv)}">S·ª≠a</a>
              <button class="btn btn-outline btn-xs btn-pill btn-del"  data-mshv="${encodeURIComponent(mshv)}">X√≥a</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    // ===== Toast helper (t∆∞∆°ng th√≠ch c·∫£ 2 ki·ªÉu g·ªçi & t·ª± t·∫°o DOM n·∫øu thi·∫øu) =====
    function showToast(msg, maybeOpts){
      // Chu·∫©n h√≥a tham s·ªë
      let type = 'danger', timeout = 2200;
      if (typeof maybeOpts === 'object' && maybeOpts !== null) {
        type = maybeOpts.type || 'danger';
        timeout = Number(maybeOpts.timeout || 2200);
      } else if (typeof maybeOpts === 'string') {
        type = maybeOpts;
        // n·∫øu c√≤n ƒë·ªëi s·ªë th·ª© 3 (ki·ªÉu c≈©), ƒë·ªçc t·ª´ arguments[2]
        if (typeof arguments[2] !== 'undefined') {
          const t = Number(arguments[2]);
          if (!Number.isNaN(t)) timeout = t;
        }
      }

      let toast = document.getElementById('toast');
      let inner = document.getElementById('toastInner');

      // T·ª± t·∫°o n·∫øu thi·∫øu
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.className = 'fixed top-8 left-1/2 -translate-x-1/2 z-[9999] pointer-events-none hidden';
        document.body.appendChild(toast);
      }
      if (!inner) {
        inner = document.createElement('div');
        inner.id = 'toastInner';
        inner.className = 'px-5 py-3 rounded-xl shadow-xl text-white font-semibold backdrop-blur transition-all duration-300 scale-95 opacity-0 max-w-[90vw] sm:max-w-md text-center';
        toast.appendChild(inner);
      }

      const colors = {
        info: 'bg-blue-600/95',
        success: 'bg-green-600/95',
        warn: 'bg-amber-600/95',
        warning: 'bg-amber-600/95',
        error: 'bg-rose-600/95',
        danger: 'bg-rose-600/95'
      };

      inner.className = `px-5 py-3 rounded-xl shadow-xl text-white font-semibold backdrop-blur transition-all duration-300 scale-95 opacity-0 max-w-[90vw] sm:max-w-md text-center ${colors[type] || colors.danger}`;
      inner.textContent = String(msg || '');

      toast.classList.remove('hidden');
      requestAnimationFrame(() => {
        inner.classList.replace('scale-95', 'scale-100');
        inner.classList.replace('opacity-0', 'opacity-100');
      });

      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => {
        inner.classList.replace('scale-100', 'scale-95');
        inner.classList.replace('opacity-100', 'opacity-0');
        setTimeout(() => toast.classList.add('hidden'), 300);
      }, timeout);
    }

    // ===== Modal nh·∫≠p l√Ω do (Promise) =====
    function askDeleteReason(message, placeholder=''){
      const overlay = document.getElementById('delModal');
      const msg = document.getElementById('delMsg');
      const txt = document.getElementById('delReason');
      const err = document.getElementById('delErr');
      const ok = document.getElementById('delOk');
      const cancel = document.getElementById('delCancel');

      msg.textContent = message || 'X√≥a b·∫£n ghi n√†y?';
      txt.value = placeholder || '';
      err.classList.add('hidden');
      overlay.classList.add('show');
      txt.focus();

      return new Promise(resolve=>{
        const done = (val)=>{ 
          overlay.classList.remove('show');
          ok.removeEventListener('click', onOk);
          cancel.removeEventListener('click', onCancel);
          overlay.removeEventListener('click', onBackdrop);
          document.removeEventListener('keydown', onEsc);
          resolve(val);
        };
        const onOk = ()=>{ 
          const v = (txt.value||'').trim();
          if(!v){ err.classList.remove('hidden'); txt.focus(); return; }
          done(v);
        };
        const onCancel = ()=> done(null);
        const onBackdrop = (e)=>{ if(e.target===overlay) done(null); };
        const onEsc = (e)=>{ if(e.key==='Escape') done(null); };

        ok.addEventListener('click', onOk);
        cancel.addEventListener('click', onCancel);
        overlay.addEventListener('click', onBackdrop);
        document.addEventListener('keydown', onEsc);
      });
    }

    // bind delete (x√≥a t·∫°m + ·∫©n d√≤ng ngay)
    document.addEventListener('DOMContentLoaded', () => {
      const tbody = document.getElementById('tbody');
      if (!tbody) return;

      tbody.addEventListener('click', async (e) => {
        const btn = e.target.closest('.btn-del');
        if (!btn) return;

        if (btn.disabled) { showToast('B·∫°n kh√¥ng c√≥ quy·ªÅn xo√°.', {type:'warn'}, 2000); return; }

        const mshv = decodeURIComponent(btn.dataset.mshv || '');
        if (!mshv) return;

        const reason = await askDeleteReason(`X√≥a h·ªì s∆° MSHV ${mshv} ?`, '');
        if (reason === null) return;

        const original = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'ƒêang xo√°‚Ä¶';

        let resp = null;
        try {
          resp = await apiFetch(`/applicants/${encodeURIComponent(mshv)}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ reason })
          });
        } catch (_) {}

        if (!resp) {
          showToast('Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y ch·ªß.', {type:'error', timeout:2200});
        } else if (resp.status === 204 || resp.status === 410) {
          // ƒê√°nh d·∫•u ƒë√£ xo√° ƒë·ªÉ kh√¥ng hi·ªán l·∫°i ·ªü m·ªçi l·∫ßn t√¨m ti·∫øp theo (trong phi√™n)
          deletedMshv.add(String(mshv));
          persistDeletedMshv();

          // ·∫®n d√≤ng ngay cho m∆∞·ª£t
          const tr = btn.closest('tr'); if (tr) tr.remove();
          showToast(`ƒê√£ x√≥a MSHV ${mshv}`, {type:'danger'});

          // Render l·∫°i d·ª±a tr√™n cache hi·ªán t·∫°i ƒë·ªÉ ƒë·ªìng b·ªô t·ªïng/trang
          await runSearch();
        } else {
          let msg = `X√≥a th·∫•t b·∫°i (HTTP ${resp.status})`;
          try { const t = await resp.text(); const j = JSON.parse(t); if (j?.detail) msg = j.detail; } catch {}
          showToast(msg, {type:'error', timeout:2600});
        }

        btn.textContent = original;
        btn.disabled = false;
      });
    });

    (function colorDeleteButtons(){
      const btns = Array.from(document.querySelectorAll('button, a'));
      btns.forEach(b => {
        const t = b.textContent?.trim();
        if (t === 'X√≥a' || t === 'Xo√°') {
          b.classList.add(
            'border', 'border-rose-600', 'text-rose-600',
            'hover:bg-rose-600', 'hover:text-white',
            'focus:ring-2','focus:ring-rose-400','focus:outline-none'
          );
          // n·∫øu ƒëang c√≥ m√†u xanh/gray th√¨ b·ªè
          b.classList.remove('btn-primary','text-gray-700','border-gray-300');
          // bo g√≥c m·ªÅm t√≠
          b.classList.add('rounded-lg');
        }
      });
    })();

    function updatePagerUI(total, page, size){
      $("count").textContent = String(total);
      document.querySelectorAll('.pager').forEach(p => {
        p.querySelector('.pager-info').textContent = `Trang ${page}/${Math.max(1, Math.ceil(total/size))} ‚Ä¢ ${total} m·ª•c`;
        const totalPages = Math.max(1, Math.ceil(total/size));
        p.querySelector('.pager-first').disabled = page <= 1;
        p.querySelector('.pager-prev').disabled  = page <= 1;
        p.querySelector('.pager-next').disabled  = page >= totalPages;
        p.querySelector('.pager-last').disabled  = page >= totalPages;
      });
    }

    // s·∫Øp x·∫øp client-side (tr√™n to√†n t·∫≠p)
    function applySort(list){
      const {key, dir} = state.sort;
      if (!key) return list;
      const getVal = (it)=>{
        if (key === 'ma_so_hv')   return (it.ma_so_hv || "").toString();
        if (key === 'dot')        return (it.dot || it.dot_tuyen || "").toString();
        if (key === 'khoa')       return (it.khoa || it.khoa_hoc || it.khoahoc || "").toString();
        if (key === 'nganh')      return (it.nganh_nhap_hoc || it.nganh || "").toString();
        if (key === 'nguoi_nhan') return (it.nguoi_nhan_ky_ten || it.nguoi_nhan || it.nguoi_ky || "").toString();
        if (key === 'ngay_nhan_hs') return (it.ngay_nhan_hs || "");
        return "";
      };
      const collator = new Intl.Collator('vi', {numeric:true, sensitivity:'base'});
      const arr = list.slice().sort((a,b)=> collator.compare(getVal(a), getVal(b)));
      return dir === 'asc' ? arr : arr.reverse();
    }

    function setAriaSort(){
      document.querySelectorAll('.th-sortable').forEach(th=> th.removeAttribute('aria-sort'));
      if (state.sort.key){
        const th = document.querySelector(`.th-sortable[data-sort="${state.sort.key}"]`);
        if (th) th.setAttribute('aria-sort', state.sort.dir === 'asc' ? 'ascending' : 'descending');
      }
    }

    async function toggleSort(key){
      if (state.sort.key === key){
        state.sort.dir = (state.sort.dir === 'asc' ? 'desc' : 'asc');
      } else {
        state.sort.key = key; state.sort.dir = 'asc';
      }
      setAriaSort();
      // Lu√¥n sort tr√™n to√†n t·∫≠p hi·ªán t·∫°i (cacheAll) r·ªìi m·ªõi ph√¢n trang
      await runSearch();
    }

    // --- Helpers chu·∫©n ho√° v√† fetch ---
    function normalizePaged(data) {
      if (!data) return { items: [], total: 0, page: 1, size: 0 };
      if (Array.isArray(data.items)) {
        return { items: data.items, total: Number(data.total ?? data.items.length ?? 0), page: Number(data.page ?? 1), size: Number(data.size ?? data.items.length ?? 0) };
      }
      if (Array.isArray(data.results)) {
        return { items: data.results, total: Number(data.total ?? data.results.length ?? 0), page: Number(data.page ?? 1), size: Number(data.size ?? data.results.length ?? 0) };
      }
      if (Array.isArray(data)) { return { items: data, total: data.length, page: 1, size: data.length }; }
      return { items: [], total: 0, page: 1, size: 0 };
    }
    async function tryJson(url) {
      const r = await apiFetch(url).catch(()=>null);
      if (!r || !r.ok) return null;
      try { return await r.json(); } catch { return null; }
    }

    function isLikelyNameQuery(q){
      const s = (q||"").trim();
      if (!s) return false;
      const hasLetter = /[A-Za-z√Ä-·ª¥√†-·ªµ]/.test(s);
      const manyDigits = /^\d{4,}$/.test(s);
      return hasLetter && !manyDigits;
    }

    function vnNorm(s){
      return (s||"")
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
        .replace(/ƒë/g,"d").replace(/ƒê/g,"D")
        .trim().toLowerCase();
    }
    function matchScore(name, query){
      const a = vnNorm(name), b = vnNorm(query);
      if (!a || !b) return 0;
      if (a === b) return 100;
      if (a.startsWith(b)) return 90;
      if (a.includes(b)) return 70;
      const tokens = b.split(/\s+/).filter(Boolean);
      return tokens.every(t => a.includes(t)) ? 60 : 0;
    }
    function filterAndSortByName(list, q, limit=5000){
      const scored = (list||[]).map(it=>{
        const name = it.ho_ten || it.full_name || it.ten || "";
        return {it, score: matchScore(name, q)};
      }).filter(x => x.score > 0);
      scored.sort((p,q)=> q.score - p.score);
      return scored.slice(0, limit).map(x=>x.it);
    }

    // l·∫•y 1 trang server
    async function fetchPageServer(q, page, size){
      for (const k of ["q","name","full_name"]) {
        const j = await tryJson(`/applicants/search?${k}=${encodeURIComponent(q)}&page=${page}&size=${size}`);
        if (j) {
          const norm = normalizePaged(j);
          norm.items = (norm.items || []).filter(notDeleted); // l·ªçc xo√° m·ªÅm
          return norm;
        }
      }
      let j = await tryJson(`/applicants/search?page=${page}&size=${size}`);
      if (j) { const norm = normalizePaged(j); norm.items = (norm.items || []).filter(notDeleted); return norm; }
      j = await tryJson(`/applicants?page=${page}&size=${size}`);
      if (j) { const norm = normalizePaged(j); norm.items = (norm.items || []).filter(notDeleted); return norm; }
      return { items: [], total: 0, page: 1, size: size };
    }

    // l·∫•y nhi·ªÅu trang (ƒë·ªÉ sort/loc client)
    async function fetchUpTo(limit=5000){
      const out = [];
      let page = 1;
      const size = 200;
      for(;;){
        const data = await fetchPageServer(state.q, page, size);
        (data.items||[]).forEach(x => { if (notDeleted(x)) out.push(x); });
        const total = data.total ?? out.length;
        if (out.length >= total || out.length >= limit || (data.items||[]).length === 0 || (data.items||[]).length < size) break;
        page += 1;
      }
      return out.slice(0, limit);
    }

    function applyClientFilters(list){
      const dot  = $("filterDot").value.trim().toLowerCase();
      const khoa = $("filterKhoa").value.trim().toLowerCase();
      return (list||[]).filter(it=>{
        const _dot  = String(it.dot ?? it.dot_tuyen ?? "").toLowerCase();
        const _khoa = String(it.khoa ?? it.khoa_hoc ?? it.khoahoc ?? "").toLowerCase();
        const okDot  = !dot  || _dot.includes(dot);
        const okKhoa = !khoa || _khoa === khoa || _khoa.includes(khoa);
        return okDot && okKhoa;
      });
    }

    async function buildSourceFull(){
      // L·∫•y to√†n b·ªô theo truy v·∫•n hi·ªán t·∫°i, l·ªçc xo√° m·ªÅm, SORT TR∆Ø·ªöC, r·ªìi paginate
      state.cacheAll = (await fetchUpTo(5000)).filter(notDeleted);
      // L·ªçc theo ƒë·ª£t/kh√≥a n·∫øu c√≥
      const wantFilter = $("filterDot").value.trim() !== "" || $("filterKhoa").value.trim() !== "";
      let list = wantFilter ? applyClientFilters(state.cacheAll) : state.cacheAll.slice();
      list = applySort(list); // lu√¥n sort tr√™n to√†n t·∫≠p
      return list;
    }

    async function runSearch(){
      setState({loading:true});
      try{
        // Lu√¥n d·ª±a v√†o to√†n b·ªô dataset hi·ªán t·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o sort tr√™n full set
        const full = await buildSourceFull();
        state.total = full.length;

        // T√≠nh trang h·ª£p l·ªá
        const totalPages = Math.max(1, Math.ceil(state.total / state.size));
        if (state.page > totalPages) state.page = totalPages;

        // C·∫Øt trang v√† render
        const start = (state.page - 1) * state.size;
        renderRows(full.slice(start, start + state.size));
        updatePagerUI(state.total, state.page, state.size);
        setState({loading:false, empty: state.total === 0});
      }catch(e){
        setState({loading:false, empty:true});
        $("msg").textContent = e.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh";
      }
    }

    // ===== File helpers =====
    async function fetchFileOrAlert(url, filename, type = "excel"){
      const resp = await fetch(makeUrl(url), { credentials: "include" });
      if (!resp.ok){
        let msg = `Kh√¥ng th·ªÉ ${type === "pdf" ? "in" : "xu·∫•t"} (HTTP ${resp.status})`;
        try { const t = await resp.text(); const j = JSON.parse(t); if (j?.detail) msg = j.detail; } catch(_){}
        alert(msg);
        return;
      }
      const blob = await resp.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 60000);
    }

    async function openPdfOrAlert(url){
      const resp = await fetch(makeUrl(url), { credentials: "include" });
      if (!resp.ok){
        let msg = `Kh√¥ng th·ªÉ in (HTTP ${resp.status})`;
        try { const t = await resp.text(); const j = JSON.parse(t); if (j?.detail) msg = j.detail; } catch(_){}
        alert(msg);
        return;
      }
      const blob = await resp.blob();
      const u = URL.createObjectURL(blob);
      window.open(u, "_blank");
      setTimeout(()=>URL.revokeObjectURL(u), 60000);
    }

    // ===== Export/In ·∫•n theo ng√†y/ƒë·ª£t =====
    $("day").value = new Date().toISOString().slice(0,10);

    $("btnExportDay").onclick = async ()=>{
      const d = $("day").value;
      if (!d){ alert("Ch·ªçn ng√†y tr∆∞·ªõc ƒë√£"); return; }
      await fetchFileOrAlert(`/export/excel?day=${encodeURIComponent(d)}`, `tong_ngay_${d}.xlsx`, "excel");
    };
    $("btnPrintDay").onclick = async ()=>{
      const d = $("day").value;
      if (!d){ alert("Ch·ªçn ng√†y tr∆∞·ªõc ƒë√£"); return; }
      await openPdfOrAlert(`/batch/print?day=${encodeURIComponent(d)}`);
    };
    $("btnExportDot").onclick = async ()=>{
      const dot  = $("dot").value.trim();
      const khoa = $("dotKhoa").value.trim();
      if (!dot){ alert("Nh·∫≠p t√™n ƒë·ª£t tr∆∞·ªõc ƒë√£"); return; }
      let url = `/export/excel-dot?dot=${encodeURIComponent(dot)}`;
      if (khoa) url += `&khoa=${encodeURIComponent(khoa)}`;
      const fname = `tong_dot_${dot}${khoa ? `_khoa_${khoa}` : ""}.xlsx`;
      await fetchFileOrAlert(url, fname, "excel");
    };
    $("btnPrintDot").onclick = async ()=>{
      const dot  = $("dot").value.trim();
      const khoa = $("dotKhoa").value.trim();
      if (!dot){ alert("Nh·∫≠p t√™n ƒë·ª£t tr∆∞·ªõc ƒë√£"); return; }
      let url = `/batch/print-dot?dot=${encodeURIComponent(dot)}`;
      if (khoa) url += `&khoa=${encodeURIComponent(khoa)}`;
      await openPdfOrAlert(url);
    };

    // ===== Sort header bindings =====
    function bindSortHandlers(){
      document.querySelectorAll('.th-sortable').forEach(th=>{
        const key = th.getAttribute('data-sort');
        const handler = ()=> toggleSort(key);
        th.addEventListener('click', handler);
        th.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handler(); } });
      });
    }

    // ===== Bind search/paging =====
    $("btnSearch").onclick = ()=>{ state.q = $("q").value.trim(); state.page = 1; runSearch(); };
    $("q").addEventListener("keydown", e=>{ if(e.key==="Enter") $("btnSearch").click(); });

    $("pageSize").addEventListener("change", ()=>{
      state.size = Number($("pageSize").value) || 10;
      localStorage.setItem("students.pageSize", String(state.size));
      state.page = 1; runSearch();
    });

    function bindPager(container){
      container.querySelector('.pager-first').onclick = ()=> { state.page = 1; runSearch(); };
      container.querySelector('.pager-prev').onclick  = ()=> { if (state.page > 1) { state.page--; runSearch(); } };
      container.querySelector('.pager-next').onclick  = ()=> { state.page++; runSearch(); };
      container.querySelector('.pager-last').onclick  = ()=> { state.page = pagesTotal(); runSearch(); };
    }
    document.querySelectorAll('.pager').forEach(bindPager);

    // L·ªçc client theo ƒë·ª£t/kh√≥a (debounce): render l·∫°i d·ª±a tr√™n cacheAll ƒë√£ build
    ["filterDot","filterKhoa"].forEach(id=>{
      $(id).addEventListener("input", debounce(async ()=>{
        state.page = 1;
        await runSearch();
      }, 250));
    });

    // ===== Modal Edit logic =====
    const modal = $("editModal");
    const openModal = ()=>{ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); };
    const closeModal = ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); };
    $("btnCloseModal").onclick = closeModal;
    $("btnCancelEdit").onclick = closeModal;

    async function openEditModal(mshv){
      const r = await apiFetch(`/applicants/by-mshv/${encodeURIComponent(mshv)}`).catch(()=>null);
      if (!r || !r.ok){ alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c h·ªì s∆° (HTTP ${r ? r.status : '???'})`); return; }
      const data = await r.json();
      const a = data.applicant || data;

      // n·∫øu ƒë√£ n·∫±m trong danh s√°ch xo√° th√¨ ch·∫∑n s·ª≠a
      if (!notDeleted(a)) { alert('H·ªì s∆° n√†y ƒë√£ b·ªã xo√°.'); return; }

      $("e_mshv").value    = a.ma_so_hv || mshv;
      $("e_ma_ho_so").value= a.ma_ho_so || "";
      $("e_ho_ten").value  = a.ho_ten || "";
      $("e_email").value   = a.email_hoc_vien || "";
      $("e_so_dt").value   = a.so_dt || "";
      $("e_nganh").value   = a.nganh_nhap_hoc || a.nganh || "";
      $("e_dot").value     = a.dot || a.dot_tuyen || "";
      $("e_khoa").value    = a.khoa || a.khoa_hoc || a.khoahoc || "";
      $("e_ngay_nhan").value = (a.ngay_nhan_hs_iso || a.ngay_nhan_hs || "").slice(0,10);
      $("e_ngay_sinh").value  = (a.ngay_sinh_iso || a.ngay_sinh || "").slice(0,10);
      $("e_ghi_chu").value    = a.ghi_chu || "";
      openModal();
    }

    $("editForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const mshv = $("e_mshv").value.trim();
      const body = {
        ma_ho_so: $("e_ma_ho_so").value.trim(),
        ho_ten: $("e_ho_ten").value.trim(),
        email_hoc_vien: $("e_email").value.trim() || null,
        so_dt: $("e_so_dt").value.trim() || null,
        nganh_nhap_hoc: $("e_nganh").value.trim() || null,
        dot: $("e_dot").value.trim() || null,
        khoa: $("e_khoa").value.trim() || null,
        ngay_nhan_hs: $("e_ngay_nhan").value || null,
        ngay_sinh: $("e_ngay_sinh").value || null,
        ghi_chu: $("e_ghi_chu").value.trim() || null
      };
      if (!body.ma_ho_so || !body.ho_ten){ alert("Thi·∫øu M√£ h·ªì s∆° / H·ªç t√™n."); return; }
      const btn = $("btnSaveEdit"); btn.disabled = true; const old = btn.textContent; btn.textContent = "ƒêang l∆∞u...";
      const r = await apiFetch(`/applicants/${encodeURIComponent(mshv)}`, { method:"PUT", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body) }).catch(()=>null);
      btn.disabled = false; btn.textContent = old;
      if (!r || !r.ok){ const t = r ? await r.text() : "(kh√¥ng ph·∫£n h·ªìi)"; alert(`C·∫≠p nh·∫≠t th·∫•t b·∫°i (HTTP ${r ? r.status : '???'})\n${t}`); return; }
      closeModal(); await runSearch();
    });

    // ===== init =====
    window.addEventListener('load', async () => {
      await ensureLoggedIn();
      $("q").focus();

      // Lu√¥n m·∫∑c ƒë·ªãnh 10 d√≤ng/trang, kh√¥ng ƒë·ªçc localStorage n·ªØa
      const defaultSize = 10;
      $("pageSize").value = String(defaultSize);
      state.size = defaultSize;

      bindSortHandlers();
      // Render l·∫°i d·ª±a tr√™n cache hi·ªán t·∫°i ƒë·ªÉ ƒë·ªìng b·ªô t·ªïng/trang
      if (state.page > 1 && (state.total - 1) % state.size === 0) {
        state.page--; // t·ª± l√πi 1 trang n·∫øu x√≥a h·∫øt d√≤ng cu·ªëi
      }
      await runSearch();
    });

    // l∆∞u base khi s·ª≠a
    $("apiBase").addEventListener("change", ()=>{
      localStorage.setItem(STORAGE_KEY, $("apiBase").value.trim());
    });

    // ENTER to search for ƒê·ª£t / Kh√≥a
    (function bindEnterForFilters(){
      const dotInput  = document.querySelector('#filterDot, #qDot, input[placeholder="L·ªçc theo ƒê·ª£t"]');
      const khoaInput = document.querySelector('#filterKhoa, #qKhoa, input[placeholder="L·ªçc theo Kh√≥a"]');
      function triggerSearch(){ runSearch(); }
      function bindEnter(el){ if (!el) return; el.addEventListener('keydown', (e)=>{ if (e.key === 'Enter'){ e.preventDefault(); triggerSearch(); } }); }
      bindEnter(dotInput); bindEnter(khoaInput);
    })();

    // Notification Toast (d√†nh cho v√†i n∆°i c·∫ßn popup ng·∫Øn)
    function showNoti(msg, type="info", timeout=2500){
      let box = document.getElementById("notiBox");
      let inner = document.getElementById("notiInner");
      if (!box){
        box = document.createElement('div'); box.id = 'notiBox'; box.className = 'fixed inset-0 flex items-center justify-center z-[9999] pointer-events-none hidden';
        inner = document.createElement('div'); inner.id = 'notiInner'; box.appendChild(inner); document.body.appendChild(box);
      }
      const colors = { info: "bg-blue-500", success: "bg-green-500", warning: "bg-amber-500", error: "bg-rose-500" };
      inner.className = `px-6 py-3 rounded-xl shadow-xl text-white font-semibold text-center transition-all duration-300 scale-95 opacity-0 ${colors[type]||colors.info}`;
      inner.textContent = msg; box.classList.remove("hidden");
      requestAnimationFrame(()=>{ inner.classList.replace("scale-95","scale-100"); inner.classList.replace("opacity-0","opacity-100"); });
      setTimeout(()=>{ inner.classList.replace("scale-100","scale-95"); inner.classList.replace("opacity-100","opacity-0"); setTimeout(()=> box.classList.add("hidden"), 300); }, timeout);
    }

    (async function controlJournalButton(){
      await detectPrefix();
      const link = document.getElementById('journalLink');
      if (!link) return;

      let role = null;
      try {
        const r = await apiFetch('/me');
        if (r && r.ok) {
          const me = await r.json();
          role = me?.role || null;
        }
      } catch (_) {}

      if (role === 'Admin' || role === 'NhanVien') {
        link.hidden = false;
        link.onclick = null;
      } else {
        link.hidden = true;
        link.addEventListener('click', (e)=>{
          e.preventDefault();
          alert('Quy·ªÅn t√†i kho·∫£n kh√¥ng ƒë∆∞·ª£c ph√©p truy c·∫≠p Nh·∫≠t k√Ω.');
        });
      }
    })();
    // B·∫Øt bu·ªôc v√†o /journal.html (kh√¥ng k√®m query)
    (function forceCleanJournalLink(){
      const link = document.getElementById('journalLink');
      if (!link) return;
      link.href = '/journal.html';                 // href s·∫°ch
      link.addEventListener('click', (e)=>{        // √©p ƒëi·ªÅu h∆∞·ªõng s·∫°ch
        // n·∫øu ƒë√£ check quy·ªÅn ·ªü ch·ªó kh√°c th√¨ kh√¥ng c·∫ßn preventDefault
        e.preventDefault();
        window.location.assign('/journal.html');
      });
    })();
  </script>

  <!-- Toast -->
  <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 z-[9999] pointer-events-none hidden">
    <div id="toastInner"
      class="px-5 py-3 rounded-xl shadow-xl text-white font-semibold
            bg-rose-600/95 backdrop-blur
            transition-all duration-300 scale-95 opacity-0
            max-w-[90vw] sm:max-w-md text-center">
    </div>
  </div>

</body>
</html>
