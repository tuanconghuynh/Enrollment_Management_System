<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang ch·ªß | AMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="hutech.png" type="image/png" />
  <style>
    /* H√¨nh n·ªÅn v√† hi·ªáu ·ª©ng m·ªù */
    body {
      background: url('hinhnen.png') center/cover fixed no-repeat;
      font-family: system-ui, sans-serif;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(3px);
      z-index: -1;
    }
    .card {
      background: white;
      border-radius: 1rem;
      border: 1px solid rgba(59,130,246,0.1);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      transition: all .2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.12);
      border-color: rgba(59,130,246,0.3);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header tr√™n c√πng -->
  <header class="w-full px-8 py-5 flex flex-col sm:flex-row items-center justify-between max-w-7xl mx-auto">
    <div class="flex items-center gap-3">
      <img src="hutech.png" class="h-10 w-10" alt="HUTECH" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-700 leading-tight">
          ADMISSION MANAGEMENT SYSTEM - AMS
        </h1>
        <!-- üåê D√≤ng ti·∫øng Vi·ªát b√™n d∆∞·ªõi -->
        <p class="text-sm sm:text-base text-gray-600 font-medium tracking-wide">
          V-HT.PTƒêT - H·ªá Th·ªëng Qu·∫£n L√Ω H·ªì S∆° Nh·∫≠p H·ªçc (AMS)
        </p>
      </div>
    </div>

    <div class="mt-4 sm:mt-0 flex items-center gap-3 relative">
      <!-- N√∫t t√™n + menu -->
      <button id="userMenuBtn"
        class="text-base text-gray-700 bg-white/70 hover:bg-white px-3 py-2 rounded-lg shadow border flex items-center gap-2"
        aria-haspopup="true" aria-expanded="false">
        <span id="hello">Hi, <b>‚Äî</b> <span class="text-gray-500">(‚Äî)</span></span>
        <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor" class="text-gray-500">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.187l3.71-3.956a.75.75 0 011.08 1.04l-4.24 4.52a.75.75 0 01-1.08 0l-4.24-4.52a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
        </svg>
      </button>

      <!-- Dropdown -->
    <div id="userMenu"
      class="hidden absolute right-0 top-[calc(100%+6px)] w-56 bg-white border rounded-xl shadow-lg overflow-hidden z-20">
      <a href="/account" class="block px-4 py-2 hover:bg-gray-50">üîé Th√¥ng tin t√†i kho·∫£n</a>
      <a href="/account" class="block px-4 py-2 hover:bg-gray-50">üîê ƒê·ªïi m·∫≠t kh·∫©u</a>
      <button id="btnMenuLogout" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600">‚Ü©Ô∏è ƒêƒÉng xu·∫•t</button>
    </div>

    </div>
  </header>

  <!-- Ph·∫ßn ch·ª©c nƒÉng ·ªü gi·ªØa -->
  <main class="flex-1 flex items-center justify-center">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 px-8 py-12 text-left">

      <a id="cardNhap" href="/compilation.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">üìù</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Nh·∫≠p h·ªì s∆° m·ªõi</h2>
            <p class="text-gray-600 mt-1">T·∫°o m·ªõi v√† bi√™n nh·∫≠n h·ªì s∆° nh·∫≠p h·ªçc.</p>
          </div>
        </div>
      </a>

      <a id="cardDSHS" href="/students_list.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">üìã</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Danh s√°ch h·ªì s∆°</h2>
            <p class="text-gray-600 mt-1">Xem, tra c·ª©u v√† qu·∫£n l√Ω h·ªì s∆° ƒë√£ nh·∫≠p.</p>
          </div>
        </div>
      </a>

      <a id="cardImport" href="/import_students.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">‚¨áÔ∏è</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Import h·ªçc vi√™n</h2>
            <p class="text-gray-600 mt-1">T·∫£i danh s√°ch h·ªçc vi√™n t·ª´ Excel.</p>
          </div>
        </div>
      </a>

      <a id="cardJournal" href="/journal.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">üïì</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Nh·∫≠t k√Ω h·ªá th·ªëng</h2>
            <p class="text-gray-600 mt-1">Theo d√µi ho·∫°t ƒë·ªông v√† kh√¥i ph·ª•c d·ªØ li·ªáu.</p>
          </div>
        </div>
      </a>

      <a id="cardAdmin" href="/admin" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">üë§</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Qu·∫£n l√Ω t√†i kho·∫£n</h2>
            <p class="text-gray-600 mt-1">Ch·ªânh quy·ªÅn, th√™m ng∆∞·ªùi d√πng.</p>
          </div>
        </div>
      </a>

      <a id="cardChecklist" href="/checklist_admin.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">üìë</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Qu·∫£n l√Ω Danh m·ª•c h·ªì s∆°</h2>
            <p class="text-gray-600 mt-1">Th√™m, s·ª≠a, xo√° m·ª•c checklist, s·∫Øp x·∫øp th·ª© t·ª±.</p>
          </div>
        </div>
      </a>

    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-[#1E50B4] text-white mt-auto">
    <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 text-sm">
      <div>
        <p class="font-semibold uppercase">VI·ªÜN H·ª¢P T√ÅC V√Ä PH√ÅT TRI·ªÇN ƒê√ÄO T·∫†O</p>
        <p class="uppercase">TR∆Ø·ªúNG ƒê·∫†I H·ªåC C√îNG NGH·ªÜ TPHCM (HUTECH)</p>
        <p><b>S√†i G√≤n Campus:</b> 475A ƒêi·ªán Bi√™n Ph·ªß, Ph∆∞·ªùng Th·∫°nh M·ªπ T√¢y, TP.HCM</p>
        <p>
          <b>ƒêT:</b> (028) 6686 6465 ¬∑ 
          <b>Email:</b> <a href="mailto:daotaotructuyen@hutech.edu.vn" class="underline hover:text-yellow-300">daotaotructuyen@hutech.edu.vn</a>
        </p>
      </div>
      <p class="text-xs">¬© V-HT.PTƒêT HUTECH ‚Äî Code by HC-Tu·∫•n</p>
    </div>
  </footer>

  <script>
    async function api(path, opt={}) {
      try { return await fetch('/api' + path, { credentials:'include', ...opt }); }
      catch { return null; }
    }
    function show(id){ document.getElementById(id)?.classList.remove('hidden'); }

    // Toggle dropdown
    (function menuSetup(){
      const btn = document.getElementById('userMenuBtn');
      const menu = document.getElementById('userMenu');
      if(!btn || !menu) return;

      function openMenu(open){
        menu.classList.toggle('hidden', !open);
        btn.setAttribute('aria-expanded', String(open));
      }
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        openMenu(menu.classList.contains('hidden'));
      });
      document.addEventListener('click', ()=>{
        if(!menu.classList.contains('hidden')) openMenu(false);
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') openMenu(false);
      });

    // Menu logout (c√≥ x√°c nh·∫≠n)
    document.getElementById('btnMenuLogout')?.addEventListener('click', async ()=>{
      const confirmLogout = confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?");
      if (!confirmLogout) return;
      await api('/logout', { method:'POST' });
      location.href = '/auth_login.html';
    });
    })();

    async function boot(){
      const r = await api('/me');
      if (!r || !r.ok) { location.href = '/auth_login.html'; return; }
      const me = await r.json();
      const role = me.role || '';
      const name = me.full_name || me.username || 'Ng∆∞·ªùi d√πng';
      document.getElementById('hello').innerHTML = `<b>${name}</b> <span class="text-gray-500">(${role})</span>`;
      // N·∫øu b·∫Øt ƒë·ªïi m·∫≠t kh·∫©u l·∫ßn ƒë·∫ßu ‚Üí ƒë∆∞a th·∫≥ng sang account (ph√≤ng tr∆∞·ªùng h·ª£p bypass)
      if (me.must_change_password) {
        location.href = '/account?first=1';
        return;
      }
      // Ph√¢n quy·ªÅn
      if (role === 'Admin') {
        ['cardNhap','cardDSHS','cardImport','cardJournal','cardAdmin','cardChecklist'].forEach(show);
      } else if (role === 'NhanVien') {
        ['cardNhap','cardDSHS','cardImport','cardJournal'].forEach(show);
      } else {
        ['cardNhap','cardDSHS'].forEach(show);
      }
    }
    boot();
  </script>
</body>
</html>
