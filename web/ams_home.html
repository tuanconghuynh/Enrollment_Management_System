<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang chá»§ | AMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="hutech.png" type="image/png" />
  <style>
    /* HÃ¬nh ná»n vÃ  hiá»‡u á»©ng má» */
    body {
      background: url('hinhnen.png') center/cover fixed no-repeat;
      font-family: system-ui, sans-serif;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(3px);
      z-index: -1;
    }
    .card {
      background: white;
      border-radius: 1rem;
      border: 1px solid rgba(59,130,246,0.1);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      transition: all .2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.12);
      border-color: rgba(59,130,246,0.3);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header trÃªn cÃ¹ng -->
  <header class="w-full px-8 py-5 flex flex-col sm:flex-row items-center justify-between max-w-7xl mx-auto">
    <div class="flex items-center gap-3">
      <a href="/ams_home.html" class="flex items-center gap-3 hover:opacity-90 transition" title="Vá» trang chá»§">
        <img src="hutech.png" class="h-10 w-10" alt="HUTECH" />
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-700 leading-tight">
            ADMISSION MANAGEMENT SYSTEM - AMS
          </h1>
          <p class="text-sm sm:text-base text-gray-600 font-medium tracking-wide">
            V-HT.PTÄT - Há»‡ Thá»‘ng Quáº£n LÃ½ Há»“ SÆ¡ Nháº­p Há»c (AMS)
          </p>
        </div>
      </a>
    </div>
    <div class="mt-4 sm:mt-0 flex items-center gap-3 relative">
      <!-- NÃºt tÃªn + menu -->
      <button id="userMenuBtn"
        class="text-base text-gray-700 bg-white/70 hover:bg-white px-3 py-2 rounded-lg shadow border flex items-center gap-2"
        aria-haspopup="true" aria-expanded="false">
        <span id="hello">Hi, <b>â€”</b> <span class="text-gray-500">(â€”)</span></span>
        <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor" class="text-gray-500">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.187l3.71-3.956a.75.75 0 011.08 1.04l-4.24 4.52a.75.75 0 01-1.08 0l-4.24-4.52a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
        </svg>
      </button>

      <!-- Dropdown -->
    <div id="userMenu"
      class="hidden absolute right-0 top-[calc(100%+6px)] w-56 bg-white border rounded-xl shadow-lg overflow-hidden z-20">
      <a href="/account" class="block px-4 py-2 hover:bg-gray-50">ğŸ” ThÃ´ng tin tÃ i khoáº£n</a>
      <a href="/account" class="block px-4 py-2 hover:bg-gray-50">ğŸ” Äá»•i máº­t kháº©u</a>
      <button id="btnMenuLogout" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600">â†©ï¸ ÄÄƒng xuáº¥t</button>
    </div>

    </div>
  </header>

  <!-- Pháº§n chá»©c nÄƒng á»Ÿ giá»¯a -->
  <main class="flex-1 flex items-center justify-center">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 px-8 py-12 text-left">

      <a id="cardNhap" href="/compilation.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">ğŸ“</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Nháº­p há»“ sÆ¡ má»›i</h2>
            <p class="text-gray-600 mt-1">Táº¡o má»›i vÃ  biÃªn nháº­n há»“ sÆ¡ nháº­p há»c.</p>
          </div>
        </div>
      </a>

      <a id="cardDSHS" href="/students_list.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">ğŸ“‹</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Danh sÃ¡ch há»“ sÆ¡</h2>
            <p class="text-gray-600 mt-1">Xem, tra cá»©u vÃ  quáº£n lÃ½ há»“ sÆ¡ Ä‘Ã£ nháº­p.</p>
          </div>
        </div>
      </a>

      <a id="cardImport" href="/import_students.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">â¬‡ï¸</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Import há»c viÃªn</h2>
            <p class="text-gray-600 mt-1">Táº£i danh sÃ¡ch há»c viÃªn tá»« Excel.</p>
          </div>
        </div>
      </a>

      <a id="cardJournal" href="/journal.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">ğŸ•“</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Nháº­t kÃ½ há»‡ thá»‘ng</h2>
            <p class="text-gray-600 mt-1">Theo dÃµi hoáº¡t Ä‘á»™ng vÃ  khÃ´i phá»¥c dá»¯ liá»‡u.</p>
          </div>
        </div>
      </a>

      <a id="cardAdmin" href="/admin" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">ğŸ‘¤</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Quáº£n lÃ½ tÃ i khoáº£n</h2>
            <p class="text-gray-600 mt-1">Chá»‰nh quyá»n, thÃªm ngÆ°á»i dÃ¹ng.</p>
          </div>
        </div>
      </a>

      <a id="cardChecklist" href="/checklist_admin.html" class="card p-6 hidden">
        <div class="flex items-start gap-4">
          <div class="text-4xl">ğŸ“‘</div>
          <div>
            <h2 class="text-xl font-bold text-blue-700">Quáº£n lÃ½ Danh má»¥c há»“ sÆ¡</h2>
            <p class="text-gray-600 mt-1">ThÃªm, sá»­a, xoÃ¡ má»¥c checklist, sáº¯p xáº¿p thá»© tá»±.</p>
          </div>
        </div>
      </a>

    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-[#1E50B4] text-white mt-auto">
    <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 text-sm">
      <div>
        <p class="font-semibold uppercase">VIá»†N Há»¢P TÃC VÃ€ PHÃT TRIá»‚N ÄÃ€O Táº O</p>
        <p class="uppercase">TRÆ¯á»œNG Äáº I Há»ŒC CÃ”NG NGHá»† TPHCM (HUTECH)</p>
        <p><b>SÃ i GÃ²n Campus:</b> 475A Äiá»‡n BiÃªn Phá»§, PhÆ°á»ng Tháº¡nh Má»¹ TÃ¢y, TP.HCM</p>
        <p>
          <b>ÄT:</b> (028) 6686 6465 Â· 
          <b>Email:</b> <a href="mailto:daotaotructuyen@hutech.edu.vn" class="underline hover:text-yellow-300">daotaotructuyen@hutech.edu.vn</a>
        </p>
      </div>
      <p class="text-xs">Â© V-HT.PTÄT HUTECH â€” Code by HC-Tuáº¥n</p>
    </div>
  </footer>

  <script>
    async function api(path, opt={}) {
      try { return await fetch('/api' + path, { credentials:'include', ...opt }); }
      catch { return null; }
    }
    function show(id){ document.getElementById(id)?.classList.remove('hidden'); }

    // Toggle dropdown
    (function menuSetup(){
      const btn = document.getElementById('userMenuBtn');
      const menu = document.getElementById('userMenu');
      if(!btn || !menu) return;

      function openMenu(open){
        menu.classList.toggle('hidden', !open);
        btn.setAttribute('aria-expanded', String(open));
      }
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        openMenu(menu.classList.contains('hidden'));
      });
      document.addEventListener('click', ()=>{
        if(!menu.classList.contains('hidden')) openMenu(false);
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') openMenu(false);
      });

    // Menu logout (cÃ³ xÃ¡c nháº­n)
    document.getElementById('btnMenuLogout')?.addEventListener('click', async ()=>{
      const confirmLogout = confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘Äƒng xuáº¥t khÃ´ng?");
      if (!confirmLogout) return;
      await api('/logout', { method:'POST' });
      location.href = '/auth_login.html';
    });
    })();

    async function boot(){
      const r = await api('/me');
      if (!r || !r.ok) { location.href = '/auth_login.html'; return; }
      const me = await r.json();
      const role = me.role || '';
      const name = me.full_name || me.username || 'NgÆ°á»i dÃ¹ng';
      document.getElementById('hello').innerHTML = `<b>${name}</b> <span class="text-gray-500">(${role})</span>`;
      // Náº¿u báº¯t Ä‘á»•i máº­t kháº©u láº§n Ä‘áº§u â†’ Ä‘Æ°a tháº³ng sang account (phÃ²ng trÆ°á»ng há»£p bypass)
      if (me.must_change_password) {
        location.href = '/account?first=1';
        return;
      }
      // PhÃ¢n quyá»n
      if (role === 'Admin') {
        ['cardNhap','cardDSHS','cardImport','cardJournal','cardAdmin','cardChecklist'].forEach(show);
      } else if (role === 'NhanVien') {
        ['cardNhap','cardDSHS','cardImport','cardJournal'].forEach(show);
      } else {
        ['cardNhap','cardDSHS'].forEach(show);
      }
    }
    boot();
    (function () {
      // Æ¯u tiÃªn query expired=1 (khi bá»‹ redirect)
      const params = new URLSearchParams(location.search);
      const byQuery = params.get('expired') === '1';

      // Hoáº·c cookie cá» do BE set
      const byCookie = document.cookie.split(';').some(c => c.trim().startsWith('__session_expired=1'));

      if (byQuery || byCookie) {
        // Hiá»‡n thÃ´ng bÃ¡o rá»™ng rÃ£i
        if (typeof showToast === 'function') {
          showToast('PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n, vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.', 'warn', 4500);
        } else {
          // Fallback náº¿u trang khÃ´ng cÃ³ showToast
          alert('PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n, vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.');
        }
        // XÃ³a cookie cá» Ä‘á»ƒ khá»i láº·p láº¡i
        document.cookie = '__session_expired=; Max-Age=0; Path=/; SameSite=Lax';
      }
    })();
  </script>
</body>
</html>
