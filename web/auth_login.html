<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đăng nhập | Admission Check</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="/hutech.png" sizes="32x32">
  <link rel="icon" type="image/png" href="hutech.png" sizes="32x32">
  <link rel="apple-touch-icon" href="hutech.png">
  <meta name="theme-color" content="#2563eb">
  <style>
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    /* nền banner toàn màn hình, mờ + tối nhẹ */
    .login-bg{
      position:fixed; inset:0; z-index:-1;
      background: url('banner.png') center/cover no-repeat;
      filter: blur(4px) saturate(105%);
    }
    .login-overlay{
      position:fixed; inset:0; z-index:-1;
      background: linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,.35));
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <!-- Background (banner + overlay) -->
  <div class="login-bg" aria-hidden="true"></div>
  <div class="login-overlay" aria-hidden="true"></div>

  <div class="w-full max-w-md">
    <div class="rounded-2xl shadow-2xl p-8 bg-white/90 backdrop-blur-md">
      <div class="flex items-center gap-3 mb-6">
        <img src="/hutech.png" class="h-10 w-10" alt="HUTECH">
        <div>
          <h1 class="text-xl font-bold leading-tight">Viện Hợp tác &amp; Phát triển Đào tạo</h1>
          <p class="text-sm text-gray-500">Đăng nhập - Admission Check – Trang Nội Bộ</p>
        </div>
      </div>

      <form class="space-y-4" onsubmit="return doLogin(event)">
        <div>
          <label class="block text-sm text-gray-700 font-semibold mb-1">Tài khoản</label>
          <input id="u" autocomplete="username" autofocus spellcheck="false" autocapitalize="off"
            class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300"
            placeholder="Mã NV hoặc email" required>
        </div>
        <div>
          <label class="block text-sm text-gray-700 font-semibold mb-1">Mật khẩu</label>
          <div class="relative">
            <input id="p" type="password" minlength="6" autocomplete="current-password"
              class="w-full rounded-xl border border-gray-300 px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-300"
              placeholder="••••••••" required>
            <button type="button" id="toggle" class="absolute inset-y-0 right-2 px-2 text-gray-500" title="Hiện/ẩn">👁️</button>
          </div>
        </div>
        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl py-2.5 transition mt-1">
          Đăng nhập
        </button>
        <p id="err" class="text-sm text-red-600 min-h-[1.25rem] mt-1"></p>
        <div class="mt-3 text-sm text-gray-600">
          <div class="mt-1">❗Nếu chưa có tài khoản! Hãy liên hệ Admin để được cấp.</div>
          <div class="mt-1">❗Nếu quên mật khẩu, vui lòng liên hệ Admin để được hỗ trợ khôi phục.</div>
          <div class="mt-1">📩Email Admin liên hệ:
            <a href="mailto:hc.tuan@hutech.edu.vn" class="text-blue-600 hover:underline">hc.tuan@hutech.edu.vn</a>
          </div>
          <div class="mt-1">🔎Thông tin VP:
            <a href="http://hutech.edu.vn/e-hutech" class="text-blue-600 hover:underline">Viện Hợp tác & Phát triển Đào tạo</a>
          </div>
        </div>
      <p class="text-center text-sm text-gray-600 mt-4">
        © V-HT.PTĐT HUTECH ➖ Code by: HC-TUAN
      </p>
  </div>
  <script>
    // Hiện/ẩn mật khẩu
    const p = document.getElementById('p');
    document.getElementById('toggle').onclick = () => {
      p.type = p.type === 'password' ? 'text' : 'password';
    };

    async function doLogin(e){
      e.preventDefault();
      const btn = e.target.querySelector('button[type="submit"], button:not([type])') || e.target.querySelector('button');
      const err = document.getElementById('err');
      if (err) err.textContent = '';

      const fd = new FormData();
      fd.append('username', document.getElementById('u').value.trim());
      fd.append('password', document.getElementById('p').value);

      try {
        if (btn) { btn.disabled = true; btn.classList.add('opacity-70'); }
        const r = await fetch('/api/login', { method:'POST', body: fd });
        if (!r.ok) {
          if (err) err.textContent = 'Sai tài khoản hoặc mật khẩu';
          return false;
        }
        location.href = '/index_home.html'; // giữ đúng flow hiện tại của anh
        return false;
      } catch (ex) {
        if (err) err.textContent = 'Không thể kết nối máy chủ. Vui lòng thử lại.';
        return false;
      } finally {
        if (btn) { btn.disabled = false; btn.classList.remove('opacity-70'); }
      }
    }
  </script>
</body>
</html>
